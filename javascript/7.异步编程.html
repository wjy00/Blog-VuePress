<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä¸ƒã€å¼‚æ­¥ç¼–ç¨‹ | Blog-WJY</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="WJY-Blog">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.61103f05.js" as="script"><link rel="preload" href="/assets/js/3.5422f50d.js" as="script"><link rel="preload" href="/assets/js/56.6e6b6725.js" as="script"><link rel="prefetch" href="/assets/js/10.48398857.js"><link rel="prefetch" href="/assets/js/11.8b41c02f.js"><link rel="prefetch" href="/assets/js/12.b43b0fa5.js"><link rel="prefetch" href="/assets/js/13.8ebb1414.js"><link rel="prefetch" href="/assets/js/14.c83413f7.js"><link rel="prefetch" href="/assets/js/15.6112a6db.js"><link rel="prefetch" href="/assets/js/16.9821c622.js"><link rel="prefetch" href="/assets/js/17.24637ad6.js"><link rel="prefetch" href="/assets/js/18.ba05d0f7.js"><link rel="prefetch" href="/assets/js/19.398c37df.js"><link rel="prefetch" href="/assets/js/2.a5f5b41e.js"><link rel="prefetch" href="/assets/js/20.6175dbef.js"><link rel="prefetch" href="/assets/js/21.271e947a.js"><link rel="prefetch" href="/assets/js/22.b544afc3.js"><link rel="prefetch" href="/assets/js/23.3085b46b.js"><link rel="prefetch" href="/assets/js/24.f608e65b.js"><link rel="prefetch" href="/assets/js/25.64e77ea9.js"><link rel="prefetch" href="/assets/js/26.a6095427.js"><link rel="prefetch" href="/assets/js/27.aa814ee5.js"><link rel="prefetch" href="/assets/js/28.92fc9274.js"><link rel="prefetch" href="/assets/js/29.8689cd3d.js"><link rel="prefetch" href="/assets/js/30.8a913ce1.js"><link rel="prefetch" href="/assets/js/31.74c17c5a.js"><link rel="prefetch" href="/assets/js/32.a433e998.js"><link rel="prefetch" href="/assets/js/33.92f32f1c.js"><link rel="prefetch" href="/assets/js/34.6d1e7a32.js"><link rel="prefetch" href="/assets/js/35.b453475a.js"><link rel="prefetch" href="/assets/js/36.c22e7750.js"><link rel="prefetch" href="/assets/js/37.6c33872a.js"><link rel="prefetch" href="/assets/js/38.193c163f.js"><link rel="prefetch" href="/assets/js/39.ab325b65.js"><link rel="prefetch" href="/assets/js/4.594b49aa.js"><link rel="prefetch" href="/assets/js/40.f6c77657.js"><link rel="prefetch" href="/assets/js/41.99108772.js"><link rel="prefetch" href="/assets/js/42.729c9018.js"><link rel="prefetch" href="/assets/js/43.96c9b404.js"><link rel="prefetch" href="/assets/js/44.40e1b3eb.js"><link rel="prefetch" href="/assets/js/45.49720d5f.js"><link rel="prefetch" href="/assets/js/46.ee580737.js"><link rel="prefetch" href="/assets/js/47.de619698.js"><link rel="prefetch" href="/assets/js/48.e1a28b55.js"><link rel="prefetch" href="/assets/js/49.0bc2c3f6.js"><link rel="prefetch" href="/assets/js/5.0bdab4d0.js"><link rel="prefetch" href="/assets/js/50.180a5c62.js"><link rel="prefetch" href="/assets/js/51.6442c9c7.js"><link rel="prefetch" href="/assets/js/52.d65d7ff2.js"><link rel="prefetch" href="/assets/js/53.cabe401d.js"><link rel="prefetch" href="/assets/js/54.373c862c.js"><link rel="prefetch" href="/assets/js/55.48b13b1b.js"><link rel="prefetch" href="/assets/js/57.41b3d131.js"><link rel="prefetch" href="/assets/js/58.6bd80af7.js"><link rel="prefetch" href="/assets/js/59.ab0b7ffc.js"><link rel="prefetch" href="/assets/js/6.0b7e2305.js"><link rel="prefetch" href="/assets/js/60.bd8bace5.js"><link rel="prefetch" href="/assets/js/61.07fc73df.js"><link rel="prefetch" href="/assets/js/7.81f0a449.js"><link rel="prefetch" href="/assets/js/8.880736f4.js"><link rel="prefetch" href="/assets/js/9.36b50a9e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="Blog-WJY" class="logo"> <span class="site-name can-hide">Blog-WJY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ğŸ  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  ğŸ’— å…³äº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="mobile-dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/sa/" class="nav-link">
  æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/computer/np/" class="nav-link">
  è®¡ç®—æœºç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/computer/os/" class="nav-link">
  æ“ä½œç³»ç»Ÿ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML+CSS" class="dropdown-title"><span class="title">HTML+CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML+CSS" class="mobile-dropdown-title"><span class="title">HTML+CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/htmlcss/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/htmlcss/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Node.js
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯æ¡†æ¶" class="dropdown-title"><span class="title">å‰ç«¯æ¡†æ¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯æ¡†æ¶" class="mobile-dropdown-title"><span class="title">å‰ç«¯æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶ä»–çŸ¥è¯†" class="dropdown-title"><span class="title">å…¶ä»–çŸ¥è¯†</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…¶ä»–çŸ¥è¯†" class="mobile-dropdown-title"><span class="title">å…¶ä»–çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/git/" class="nav-link">
  GIT
</a></li><li class="dropdown-item"><!----> <a href="/others/webpack/" class="nav-link">
  WEBPACK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â­ é¡¹ç›®" class="dropdown-title"><span class="title">â­ é¡¹ç›®</span> <span class="arrow down"></span></button> <button type="button" aria-label="â­ é¡¹ç›®" class="mobile-dropdown-title"><span class="title">â­ é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://demo.wjy00.top:8899/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åå°ç®¡ç†ç³»ç»Ÿé¡¹ç›®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://demo.wjy00.top:8888/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  echartç›‘æ§ç³»ç»Ÿé¡¹ç›®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  ğŸ’¬ é¢ç»
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ğŸ  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  ğŸ’— å…³äº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="mobile-dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/sa/" class="nav-link">
  æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/computer/np/" class="nav-link">
  è®¡ç®—æœºç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/computer/os/" class="nav-link">
  æ“ä½œç³»ç»Ÿ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML+CSS" class="dropdown-title"><span class="title">HTML+CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML+CSS" class="mobile-dropdown-title"><span class="title">HTML+CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/htmlcss/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/htmlcss/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Node.js
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯æ¡†æ¶" class="dropdown-title"><span class="title">å‰ç«¯æ¡†æ¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯æ¡†æ¶" class="mobile-dropdown-title"><span class="title">å‰ç«¯æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶ä»–çŸ¥è¯†" class="dropdown-title"><span class="title">å…¶ä»–çŸ¥è¯†</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…¶ä»–çŸ¥è¯†" class="mobile-dropdown-title"><span class="title">å…¶ä»–çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/git/" class="nav-link">
  GIT
</a></li><li class="dropdown-item"><!----> <a href="/others/webpack/" class="nav-link">
  WEBPACK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â­ é¡¹ç›®" class="dropdown-title"><span class="title">â­ é¡¹ç›®</span> <span class="arrow down"></span></button> <button type="button" aria-label="â­ é¡¹ç›®" class="mobile-dropdown-title"><span class="title">â­ é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://demo.wjy00.top:8899/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åå°ç®¡ç†ç³»ç»Ÿé¡¹ç›®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://demo.wjy00.top:8888/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  echartç›‘æ§ç³»ç»Ÿé¡¹ç›®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  ğŸ’¬ é¢ç»
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JAVASCRIPT</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/" aria-current="page" class="sidebar-link">JavaScript é¢è¯•å¸¸è§é—®é¢˜</a></li><li><a href="/javascript/1.æ•°æ®ç±»å‹.html" class="sidebar-link">ä¸€ã€æ•°æ®ç±»å‹</a></li><li><a href="/javascript/2.ES6.html" class="sidebar-link">äºŒã€ES6</a></li><li><a href="/javascript/3.JavaScriptåŸºç¡€.html" class="sidebar-link">ä¸‰ã€JavaScript åŸºç¡€</a></li><li><a href="/javascript/4.åŸå‹ä¸åŸå‹é“¾.html" class="sidebar-link">å››ã€åŸå‹ä¸åŸå‹é“¾</a></li><li><a href="/javascript/5.æ‰§è¡Œä¸Šä¸‹æ–‡ã€ä½œç”¨åŸŸé“¾ã€é—­åŒ….html" class="sidebar-link">äº”ã€æ‰§è¡Œä¸Šä¸‹æ–‡/ä½œç”¨åŸŸé“¾/é—­åŒ…</a></li><li><a href="/javascript/6.thisã€callã€applyã€bind.html" class="sidebar-link">å…­ã€this/call/apply/bind</a></li><li><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html" class="active sidebar-link">ä¸ƒã€å¼‚æ­¥ç¼–ç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_1-å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼" class="sidebar-link">1. å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_2-settimeoutã€promiseã€async-await-çš„åŒºåˆ«" class="sidebar-link">2. setTimeoutã€Promiseã€Async/Await çš„åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_3-å¯¹-promise-çš„ç†è§£" class="sidebar-link">3. å¯¹ Promise çš„ç†è§£</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_4-promise-çš„åŸºæœ¬ç”¨æ³•" class="sidebar-link">4. Promise çš„åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_5-promise-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="sidebar-link">5. Promise è§£å†³äº†ä»€ä¹ˆé—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_6-promise-all-å’Œ-promise-race-çš„åŒºåˆ«çš„ä½¿ç”¨åœºæ™¯" class="sidebar-link">6. Promise.all å’Œ Promise.race çš„åŒºåˆ«çš„ä½¿ç”¨åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_7-å¯¹-async-await-çš„ç†è§£" class="sidebar-link">7. å¯¹ async/await çš„ç†è§£</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_8-await-åˆ°åº•åœ¨ç­‰å•¥" class="sidebar-link">8. await åˆ°åº•åœ¨ç­‰å•¥ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_9-async-await-çš„ä¼˜åŠ¿" class="sidebar-link">9. async/await çš„ä¼˜åŠ¿</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_10-async-await-å¯¹æ¯”-promise-çš„ä¼˜åŠ¿" class="sidebar-link">10. async/await å¯¹æ¯” Promise çš„ä¼˜åŠ¿</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_11-async-await-å¦‚ä½•æ•è·å¼‚å¸¸" class="sidebar-link">11. async/await å¦‚ä½•æ•è·å¼‚å¸¸</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_12-å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«-äº†è§£å³å¯" class="sidebar-link">12. å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«ï¼Ÿ---äº†è§£å³å¯</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_13-ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°-å›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹-å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜" class="sidebar-link">13. ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼Ÿå›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿå¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/javascript/7.å¼‚æ­¥ç¼–ç¨‹.html#_14-settimeoutã€setintervalã€requestanimationframe-å„æœ‰ä»€ä¹ˆç‰¹ç‚¹" class="sidebar-link">14. setTimeoutã€setIntervalã€requestAnimationFrame å„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</a></li></ul></li><li><a href="/javascript/8.é¢å‘å¯¹è±¡.html" class="sidebar-link">å…«ã€é¢å‘å¯¹è±¡</a></li><li><a href="/javascript/9.åƒåœ¾å›æ”¶ä¸å†…å­˜æ³„æ¼.html" class="sidebar-link">ä¹ã€åƒåœ¾å›æ”¶ä¸å†…å­˜æ³„æ¼---äº†è§£å³å¯</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ä¸ƒã€å¼‚æ­¥ç¼–ç¨‹"><a href="#ä¸ƒã€å¼‚æ­¥ç¼–ç¨‹" class="header-anchor">#</a> ä¸ƒã€å¼‚æ­¥ç¼–ç¨‹</h1> <h2 id="_1-å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼"><a href="#_1-å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼" class="header-anchor">#</a> 1. å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼ï¼Ÿ</h2> <p>JavaScript ä¸­çš„å¼‚æ­¥æœºåˆ¶å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p> <ul><li><strong>å›è°ƒå‡½æ•°</strong> çš„æ–¹å¼ï¼Œä½¿ç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå¤šä¸ªå›è°ƒå‡½æ•°åµŒå¥—çš„æ—¶å€™ä¼šé€ æˆå›è°ƒå‡½æ•°åœ°ç‹±ï¼Œä¸Šä¸‹ä¸¤å±‚çš„å›è°ƒå‡½æ•°é—´çš„ä»£ç è€¦åˆåº¦å¤ªé«˜ï¼Œä¸åˆ©äºä»£ç çš„å¯ç»´æŠ¤ã€‚</li> <li><strong>Promise</strong> çš„æ–¹å¼ï¼Œä½¿ç”¨ Promise çš„æ–¹å¼å¯ä»¥å°†åµŒå¥—çš„å›è°ƒå‡½æ•°ä½œä¸ºé“¾å¼è°ƒç”¨ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ‰æ—¶ä¼šé€ æˆå¤šä¸ª then çš„é“¾å¼è°ƒç”¨ï¼Œå¯èƒ½ä¼šé€ æˆä»£ç çš„è¯­ä¹‰ä¸å¤Ÿæ˜ç¡®ã€‚</li> <li><strong>generator</strong> çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å‡½æ•°çš„æ‰§è¡Œæƒè½¬ç§»å‡ºå»ï¼Œåœ¨å‡½æ•°å¤–éƒ¨è¿˜å¯ä»¥å°†æ‰§è¡Œæƒè½¬ç§»å›æ¥ã€‚å½“é‡åˆ°å¼‚æ­¥å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå°†å‡½æ•°æ‰§è¡Œæƒè½¬ç§»å‡ºå»ï¼Œå½“å¼‚æ­¥å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶å†å°†æ‰§è¡Œæƒç»™è½¬ç§»å›æ¥ã€‚å› æ­¤åœ¨ generator å†…éƒ¨å¯¹äºå¼‚æ­¥æ“ä½œçš„æ–¹å¼ï¼Œå¯ä»¥ä»¥åŒæ­¥çš„é¡ºåºæ¥ä¹¦å†™ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼éœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ä½•æ—¶å°†å‡½æ•°çš„æ§åˆ¶æƒè½¬ç§»å›æ¥ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œ generator çš„æœºåˆ¶ï¼Œæ¯”å¦‚è¯´ co æ¨¡å—ç­‰æ–¹å¼æ¥å®ç° generator çš„è‡ªåŠ¨æ‰§è¡Œã€‚</li> <li><strong>async å‡½æ•°</strong> çš„æ–¹å¼ï¼Œasync å‡½æ•°æ˜¯ generator å’Œ promise å®ç°çš„ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œçš„è¯­æ³•ç³–ï¼Œå®ƒå†…éƒ¨è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œå½“å‡½æ•°å†…éƒ¨æ‰§è¡Œåˆ°ä¸€ä¸ª await è¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœè¯­å¥è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œé‚£ä¹ˆå‡½æ•°å°†ä¼šç­‰å¾… promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º resolve åå†ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚å› æ­¤å¯ä»¥å°†å¼‚æ­¥é€»è¾‘ï¼Œè½¬åŒ–ä¸ºåŒæ­¥çš„é¡ºåºæ¥ä¹¦å†™ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°å¯ä»¥è‡ªåŠ¨æ‰§è¡Œã€‚</li></ul> <h2 id="_2-settimeoutã€promiseã€async-await-çš„åŒºåˆ«"><a href="#_2-settimeoutã€promiseã€async-await-çš„åŒºåˆ«" class="header-anchor">#</a> 2. setTimeoutã€Promiseã€Async/Await çš„åŒºåˆ«</h2> <h3 id="_1-settimeout"><a href="#_1-settimeout" class="header-anchor">#</a> ï¼ˆ1ï¼‰setTimeout</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span> <span class="token comment">//1. æ‰“å° script start</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'settimeout'</span><span class="token punctuation">)</span> <span class="token comment">// 4. æ‰“å° settimeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 2. è°ƒç”¨ setTimeout å‡½æ•°ï¼Œå¹¶å®šä¹‰å…¶å®Œæˆåæ‰§è¡Œçš„å›è°ƒå‡½æ•°</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span> <span class="token comment">//3. æ‰“å° script start</span>
<span class="token comment">// è¾“å‡ºé¡ºåºï¼šscript start-&gt;script end-&gt;settimeout</span>
</code></pre></div><h3 id="_2-promise"><a href="#_2-promise" class="header-anchor">#</a> ï¼ˆ2ï¼‰Promise</h3> <p>Promise æœ¬èº«æ˜¯<strong>åŒæ­¥çš„ç«‹å³æ‰§è¡Œå‡½æ•°</strong>ï¼Œ å½“åœ¨ executor ä¸­æ‰§è¡Œ resolve æˆ–è€… reject çš„æ—¶å€™, æ­¤æ—¶æ˜¯å¼‚æ­¥æ“ä½œï¼Œ ä¼šå…ˆæ‰§è¡Œ then/catch ç­‰ï¼Œå½“ä¸»æ ˆå®Œæˆåï¼Œæ‰ä¼šå»è°ƒç”¨ resolve/reject ä¸­å­˜æ”¾çš„æ–¹æ³•æ‰§è¡Œï¼Œæ‰“å°çš„æ—¶å€™ï¼Œæ˜¯æ‰“å°çš„è¿”å›ç»“æœï¼Œä¸€ä¸ª Promise å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'settimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
<span class="token comment">// è¾“å‡ºé¡ºåº: script start-&gt;promise1-&gt;promise1 end-&gt;script end-&gt;promise2-&gt;settimeout</span>
</code></pre></div><p>å½“ JS ä¸»çº¿ç¨‹æ‰§è¡Œåˆ° Promise å¯¹è±¡æ—¶ï¼š</p> <ul><li>promise1.then() çš„å›è°ƒå°±æ˜¯ä¸€ä¸ª task</li> <li>promise1 æ˜¯ resolved æˆ– rejected: é‚£è¿™ä¸ª task å°±ä¼šæ”¾å…¥å½“å‰äº‹ä»¶å¾ªç¯å›åˆçš„ microtask queueï¼ˆå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰</li> <li>promise1 æ˜¯ pending: è¿™ä¸ª task å°±ä¼šæ”¾å…¥ äº‹ä»¶å¾ªç¯çš„æœªæ¥çš„æŸä¸ª(å¯èƒ½ä¸‹ä¸€ä¸ª)å›åˆçš„ microtask queue ä¸­</li> <li>setTimeout çš„å›è°ƒä¹Ÿæ˜¯ä¸ª task ï¼Œå®ƒä¼šè¢«æ”¾å…¥ macrotask queueï¼ˆå®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ å³ä½¿æ˜¯ 0ms çš„æƒ…å†µ</li></ul> <h3 id="_3-async-await"><a href="#_3-async-await" class="header-anchor">#</a> ï¼ˆ3ï¼‰async/await</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
<span class="token comment">// è¾“å‡ºé¡ºåºï¼šscript start-&gt;async1 start-&gt;async2-&gt;script end-&gt;async1 end</span>
</code></pre></div><p>async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ° await å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯è®©å‡ºäº†çº¿ç¨‹ï¼Œè·³å‡ºäº† async å‡½æ•°ä½“ã€‚</p> <p>ä¾‹å¦‚ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="F:%5C%E5%89%8D%E7%AB%AF%5C%E5%89%8D%E7%AB%AF%5CVuePress%5CBlog-VuePress%5Cdocs%5Cjavascript%5Cassets%5C6.png" alt="img"></p> <p>func1 çš„è¿è¡Œç»“æœå…¶å®å°±æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚å› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨ then æ¥å¤„ç†åç»­é€»è¾‘ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 30</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>await çš„å«ä¹‰ä¸ºç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯ async å‡½æ•°éœ€è¦ç­‰å¾… await åçš„å‡½æ•°æ‰§è¡Œå®Œæˆå¹¶ä¸”æœ‰äº†è¿”å›ç»“æœï¼ˆPromise å¯¹è±¡ï¼‰ä¹‹åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚await é€šè¿‡è¿”å›ä¸€ä¸ª Promise å¯¹è±¡æ¥å®ç°åŒæ­¥çš„æ•ˆæœã€‚</p> <h2 id="_3-å¯¹-promise-çš„ç†è§£"><a href="#_3-å¯¹-promise-çš„ç†è§£" class="header-anchor">#</a> 3. å¯¹ Promise çš„ç†è§£</h2> <p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ï¼Œä»–çš„å‡ºç°å¤§å¤§æ”¹å–„äº†å¼‚æ­¥ç¼–ç¨‹çš„å›°å¢ƒï¼Œé¿å…äº†åœ°ç‹±å›è°ƒï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆå›è°ƒå‡½æ•°å’Œäº‹ä»¶æ›´åˆç†å’Œæ›´å¼ºå¤§ã€‚</p> <p>æ‰€è°“ Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p> <p>ï¼ˆ1ï¼‰Promise çš„å®ä¾‹æœ‰<strong>ä¸‰ä¸ªçŠ¶æ€</strong>:</p> <ul><li>Pendingï¼ˆè¿›è¡Œä¸­ï¼‰</li> <li>Resolvedï¼ˆå·²å®Œæˆï¼‰</li> <li>Rejectedï¼ˆå·²æ‹’ç»ï¼‰</li></ul> <p>å½“æŠŠä¸€ä»¶äº‹æƒ…äº¤ç»™ promise æ—¶ï¼Œå®ƒçš„çŠ¶æ€å°±æ˜¯ Pendingï¼Œä»»åŠ¡å®Œæˆäº†çŠ¶æ€å°±å˜æˆäº† Resolvedã€æ²¡æœ‰å®Œæˆå¤±è´¥äº†å°±å˜æˆäº† Rejectedã€‚</p> <p>ï¼ˆ2ï¼‰Promise çš„å®ä¾‹æœ‰<strong>ä¸¤ä¸ªè¿‡ç¨‹</strong>ï¼š</p> <ul><li>pending -&gt; fulfilled : Resolvedï¼ˆå·²å®Œæˆï¼‰</li> <li>pending -&gt; rejectedï¼šRejectedï¼ˆå·²æ‹’ç»ï¼‰</li></ul> <p>æ³¨æ„ï¼šä¸€æ—¦ä»è¿›è¡ŒçŠ¶æ€å˜æˆä¸ºå…¶ä»–çŠ¶æ€å°±æ°¸è¿œä¸èƒ½æ›´æ”¹çŠ¶æ€äº†ã€‚</p> <p><strong>Promise çš„ç‰¹ç‚¹ï¼š</strong></p> <ul><li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼Œ<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰ã€<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™ä¹Ÿæ˜¯ promise è¿™ä¸ªåå­—çš„ç”±æ¥â€”â€”â€œ<strong>æ‰¿è¯º</strong>â€ï¼›</li> <li>ä¸€æ—¦çŠ¶æ€æ”¹å˜å°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>ï¼Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚è¿™æ—¶å°±ç§°ä¸º<code>resolved</code>ï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹ promise å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆeventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼šå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬æ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</li></ul> <p><strong>Promise çš„ç¼ºç‚¹ï¼š</strong></p> <ul><li>æ— æ³•å–æ¶ˆ Promiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</li> <li>å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</li> <li>å½“å¤„äº pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚</li></ul> <p><strong>æ€»ç»“ï¼š</strong></p> <p>Promise å¯¹è±¡æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæœ€æ—©ç”±ç¤¾åŒºæå‡ºã€‚Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª Promise å®ä¾‹ã€‚ä¸€ä¸ª Promise å®ä¾‹æœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ pendingã€resolved å’Œ rejectedï¼Œåˆ†åˆ«ä»£è¡¨äº†è¿›è¡Œä¸­ã€å·²æˆåŠŸå’Œå·²å¤±è´¥ã€‚å®ä¾‹çš„çŠ¶æ€åªèƒ½ç”± pending è½¬å˜ resolved æˆ–è€… rejected çŠ¶æ€ï¼Œå¹¶ä¸”çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå°±å‡å›ºäº†ï¼Œæ— æ³•å†è¢«æ”¹å˜äº†ã€‚</p> <p>çŠ¶æ€çš„æ”¹å˜æ˜¯é€šè¿‡ resolve() å’Œ reject() å‡½æ•°æ¥å®ç°çš„ï¼Œå¯ä»¥åœ¨å¼‚æ­¥æ“ä½œç»“æŸåè°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ”¹å˜ Promise å®ä¾‹çš„çŠ¶æ€ï¼Œå®ƒçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ª then æ–¹æ³•ï¼Œä½¿ç”¨è¿™ä¸ª then æ–¹æ³•å¯ä»¥ä¸ºä¸¤ä¸ªçŠ¶æ€çš„æ”¹å˜æ³¨å†Œå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°å±äºå¾®ä»»åŠ¡ï¼Œä¼šåœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾æ‰§è¡Œã€‚</p> <p>**æ³¨æ„ï¼š**åœ¨æ„é€  <code>Promise</code> çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°å†…éƒ¨çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œçš„</p> <h2 id="_4-promise-çš„åŸºæœ¬ç”¨æ³•"><a href="#_4-promise-çš„åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> 4. Promise çš„åŸºæœ¬ç”¨æ³•</h2> <h3 id="_1-åˆ›å»º-promise-å¯¹è±¡"><a href="#_1-åˆ›å»º-promise-å¯¹è±¡" class="header-anchor">#</a> ï¼ˆ1ï¼‰åˆ›å»º Promise å¯¹è±¡</h3> <p>Promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œ rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚</p> <p>Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... some code</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šä½¿ç”¨</strong><code>**new Promise()**</code><strong>æ¥åˆ›å»º promise å¯¹è±¡ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨</strong><code>**promise.resolve**</code><strong>å’Œ</strong> <code>**promise.reject**</code><strong>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</strong></p> <ul><li><strong>Promise.resolve</strong></li></ul> <p><code>Promise.resolve(value)</code>çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œå¯ä»¥å¯¹è¿”å›å€¼è¿›è¡Œ.then è°ƒç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// æ‰“å°å‡º11</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>resolve(11)</code>ä»£ç ä¸­ï¼Œä¼šè®© promise å¯¹è±¡è¿›å…¥ç¡®å®š(<code>resolve</code>çŠ¶æ€)ï¼Œå¹¶å°†å‚æ•°<code>11</code>ä¼ é€’ç»™åé¢çš„<code>then</code>æ‰€æŒ‡å®šçš„<code>onFulfilled</code> å‡½æ•°ï¼›</p> <p>åˆ›å»º promise å¯¹è±¡å¯ä»¥ä½¿ç”¨<code>new Promise</code>çš„å½¢å¼åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>Promise.resolve(value)</code>çš„å½¢å¼åˆ›å»º promise å¯¹è±¡ï¼›</p> <ul><li><strong>Promise.reject</strong></li></ul> <p><code>Promise.reject</code> ä¹Ÿæ˜¯<code>new Promise</code>çš„å¿«æ·å½¢å¼ï¼Œä¹Ÿåˆ›å»ºä¸€ä¸ª promise å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.reject(new Error(â€œæˆ‘é”™äº†ï¼Œè¯·åŸè°…ä¿ºï¼ï¼â€));
</code></pre></div><p>å°±æ˜¯ä¸‹é¢çš„ä»£ç  new Promise çš„ç®€å•å½¢å¼ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>new Promise(function(resolve,reject){
   reject(new Error(&quot;æˆ‘é”™äº†ï¼Œè¯·åŸè°…ä¿ºï¼ï¼&quot;));
});
</code></pre></div><p>ä¸‹é¢æ˜¯ä½¿ç”¨ resolve æ–¹æ³•å’Œ reject æ–¹æ³•ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function testPromise(ready) {
  return new Promise(function(resolve,reject){
    if(ready) {
      resolve(&quot;hello world&quot;);
    }else {
      reject(&quot;No thanks&quot;);
    }
  });
};
// æ–¹æ³•è°ƒç”¨
testPromise(true).then(function(msg){
  console.log(msg);
},function(error){
  console.log(error);
});
</code></pre></div><p>ä¸Šé¢çš„ä»£ç çš„å«ä¹‰æ˜¯ç»™<code>testPromise</code>æ–¹æ³•ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œå¦‚æœä¸º<code>true</code>çš„è¯ï¼Œé‚£ä¹ˆè°ƒç”¨ promise å¯¹è±¡ä¸­çš„<code>resolve()</code>æ–¹æ³•ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­çš„å‚æ•°ä¼ é€’ç»™åé¢çš„<code>then</code>ç¬¬ä¸€ä¸ªå‡½æ•°å†…ï¼Œå› æ­¤æ‰“å°å‡º â€œ<code>hello world</code>â€, å¦‚æœä¸º<code>false</code>çš„è¯ï¼Œä¼šè°ƒç”¨ promise å¯¹è±¡ä¸­çš„<code>reject()</code>æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥<code>then</code>çš„ç¬¬äºŒä¸ªå‡½æ•°å†…ï¼Œä¼šæ‰“å°<code>No thanks</code>ï¼›</p> <h3 id="_2-promise-æ–¹æ³•"><a href="#_2-promise-æ–¹æ³•" class="header-anchor">#</a> ï¼ˆ2ï¼‰Promise æ–¹æ³•</h3> <p>Promise æœ‰äº”ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼šthen()ã€catch()ã€all()ã€race()ã€finallyã€‚ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹è¿™äº›æ–¹æ³•ã€‚</p> <ol><li><strong>then()</strong></li></ol> <p>å½“ Promise æ‰§è¡Œçš„å†…å®¹ç¬¦åˆæˆåŠŸæ¡ä»¶æ—¶ï¼Œè°ƒç”¨<code>resolve</code>å‡½æ•°ï¼Œå¤±è´¥å°±è°ƒç”¨<code>reject</code>å‡½æ•°ã€‚Promise åˆ›å»ºå®Œäº†ï¼Œé‚£è¯¥å¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿ</p> <div class="language- extra-class"><pre class="language-text"><code>promise.then(function(value) {
  // success
}, function(error) {
  // failure
});
</code></pre></div><p><code>then</code>æ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º<code>resolved</code>æ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º<code>rejected</code>æ—¶è°ƒç”¨ã€‚å…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥çœç•¥ã€‚</p> <p><code>then</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼ˆä¸æ˜¯åŸæ¥é‚£ä¸ª Promise å®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³<code>then</code>æ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ª then æ–¹æ³•ã€‚</p> <p>å½“è¦å†™æœ‰é¡ºåºçš„å¼‚æ­¥äº‹ä»¶æ—¶ï¼Œéœ€è¦ä¸²è¡Œæ—¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>let promise = new Promise((resolve,reject)=&gt;{
    ajax('first').success(function(res){
        resolve(res);
    })
})
promise.then(res=&gt;{
    return new Promise((resovle,reject)=&gt;{
        ajax('second').success(function(res){
            resolve(res)
        })
    })
}).then(res=&gt;{
    return new Promise((resovle,reject)=&gt;{
        ajax('second').success(function(res){
            resolve(res)
        })
    })
}).then(res=&gt;{

})
</code></pre></div><p>é‚£å½“è¦å†™çš„äº‹ä»¶æ²¡æœ‰é¡ºåºæˆ–è€…å…³ç³»æ—¶ï¼Œè¿˜å¦‚ä½•å†™å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨<code>all</code> æ–¹æ³•æ¥è§£å†³ã€‚</p> <p><strong>2. catch()</strong></p> <p>Promise å¯¹è±¡é™¤äº†æœ‰ then æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ª catch æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›¸å½“äº<code>then</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒæŒ‡å‘<code>reject</code>çš„å›è°ƒå‡½æ•°ã€‚ä¸è¿‡<code>catch</code>æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œ<code>resolve</code>å›è°ƒå‡½æ•°æ—¶ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šåœæ­¢è¿è¡Œï¼Œè€Œæ˜¯è¿›å…¥<code>catch</code>æ–¹æ³•ä¸­ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>p.then((data) =&gt; {
     console.log('resolved',data);
},(err) =&gt; {
     console.log('rejected',err);
     }
);
p.then((data) =&gt; {
    console.log('resolved',data);
}).catch((err) =&gt; {
    console.log('rejected',err);
});
</code></pre></div><p><strong>3. all()</strong></p> <p><code>all</code>æ–¹æ³•å¯ä»¥å®Œæˆå¹¶è¡Œä»»åŠ¡ï¼Œ å®ƒæ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª<code>promise</code>å¯¹è±¡ã€‚å½“æ•°ç»„ä¸­æ‰€æœ‰çš„<code>promise</code>çš„çŠ¶æ€éƒ½è¾¾åˆ°<code>resolved</code>çš„æ—¶å€™ï¼Œ<code>all</code>æ–¹æ³•çš„çŠ¶æ€å°±ä¼šå˜æˆ<code>resolved</code>ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçŠ¶æ€å˜æˆäº†<code>rejected</code>ï¼Œé‚£ä¹ˆ<code>all</code>æ–¹æ³•çš„çŠ¶æ€å°±ä¼šå˜æˆ<code>rejected</code>ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>javascript
let promise1 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       resolve(1);
    },2000)
});
let promise2 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       resolve(2);
    },1000)
});
let promise3 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       resolve(3);
    },3000)
});
Promise.all([promise1,promise2,promise3]).then(res=&gt;{
    console.log(res);
    //ç»“æœä¸ºï¼š[1,2,3]
})
</code></pre></div><p>è°ƒç”¨<code>all</code>æ–¹æ³•æ—¶çš„ç»“æœæˆåŠŸçš„æ—¶å€™æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æŒ‰é¡ºåºä¿å­˜ç€æ¯ä¸€ä¸ª promise å¯¹è±¡<code>resolve</code>æ‰§è¡Œæ—¶çš„å€¼ã€‚</p> <p><strong>ï¼ˆ4ï¼‰race()</strong></p> <p><code>race</code>æ–¹æ³•å’Œ<code>all</code>ä¸€æ ·ï¼Œæ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªæ¯é¡¹éƒ½æ˜¯<code>promise</code>çš„æ•°ç»„ï¼Œä½†æ˜¯ä¸<code>all</code>ä¸åŒçš„æ˜¯ï¼Œå½“æœ€å…ˆæ‰§è¡Œå®Œçš„äº‹ä»¶æ‰§è¡Œå®Œä¹‹åï¼Œå°±ç›´æ¥è¿”å›è¯¥<code>promise</code>å¯¹è±¡çš„å€¼ã€‚å¦‚æœç¬¬ä¸€ä¸ª<code>promise</code>å¯¹è±¡çŠ¶æ€å˜æˆ<code>resolved</code>ï¼Œé‚£è‡ªèº«çš„çŠ¶æ€å˜æˆäº†<code>resolved</code>ï¼›åä¹‹ç¬¬ä¸€ä¸ª<code>promise</code>å˜æˆ<code>rejected</code>ï¼Œé‚£è‡ªèº«çŠ¶æ€å°±ä¼šå˜æˆ<code>rejected</code>ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>let promise1 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       reject(1);
    },2000)
});
let promise2 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       resolve(2);
    },1000)
});
let promise3 = new Promise((resolve,reject)=&gt;{
    setTimeout(()=&gt;{
       resolve(3);
    },3000)
});
Promise.race([promise1,promise2,promise3]).then(res=&gt;{
    console.log(res);
    //ç»“æœï¼š2
},rej=&gt;{
    console.log(rej)};
)
</code></pre></div><p>é‚£ä¹ˆ<code>race</code>æ–¹æ³•æœ‰ä»€ä¹ˆå®é™…ä½œç”¨å‘¢ï¼Ÿå½“è¦åšä¸€ä»¶äº‹ï¼Œè¶…è¿‡å¤šé•¿æ—¶é—´å°±ä¸åšäº†ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥è§£å†³ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.race([promise1,timeOutPromise(5000)]).then(res=&gt;{})
</code></pre></div><p><strong>5. finally()</strong></p> <p><code>finally</code>æ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>promise
.then(result =&gt; {Â·Â·Â·})
.catch(error =&gt; {Â·Â·Â·})
.finally(() =&gt; {Â·Â·Â·});
</code></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸ç®¡<code>promise</code>æœ€åçš„çŠ¶æ€ï¼Œåœ¨æ‰§è¡Œå®Œ<code>then</code>æˆ–<code>catch</code>æŒ‡å®šçš„å›è°ƒå‡½æ•°ä»¥åï¼Œéƒ½ä¼šæ‰§è¡Œ<code>finally</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ Promise å¤„ç†è¯·æ±‚ï¼Œç„¶åä½¿ç”¨<code>finally</code>æ–¹æ³•å…³æ‰æœåŠ¡å™¨ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>server.listen(port)
  .then(function () {
    // ...
  })
  .finally(server.stop);
</code></pre></div><p><code>finally</code>æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰åŠæ³•çŸ¥é“ï¼Œå‰é¢çš„ Promise çŠ¶æ€åˆ°åº•æ˜¯<code>fulfilled</code>è¿˜æ˜¯<code>rejected</code>ã€‚è¿™è¡¨æ˜ï¼Œ<code>finally</code>æ–¹æ³•é‡Œé¢çš„æ“ä½œï¼Œåº”è¯¥æ˜¯ä¸çŠ¶æ€æ— å…³çš„ï¼Œä¸ä¾èµ–äº Promise çš„æ‰§è¡Œç»“æœã€‚<code>finally</code>æœ¬è´¨ä¸Šæ˜¯<code>then</code>æ–¹æ³•çš„ç‰¹ä¾‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>promise
.finally(() =&gt; {
  // è¯­å¥
});
// ç­‰åŒäº
promise
.then(
  result =&gt; {
    // è¯­å¥
    return result;
  },
  error =&gt; {
    // è¯­å¥
    throw error;
  }
);
</code></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœä¸ä½¿ç”¨<code>finally</code>æ–¹æ³•ï¼ŒåŒæ ·çš„è¯­å¥éœ€è¦ä¸ºæˆåŠŸå’Œå¤±è´¥ä¸¤ç§æƒ…å†µå„å†™ä¸€æ¬¡ã€‚æœ‰äº†<code>finally</code>æ–¹æ³•ï¼Œåˆ™åªéœ€è¦å†™ä¸€æ¬¡ã€‚</p> <h2 id="_5-promise-è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#_5-promise-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="header-anchor">#</a> 5. Promise è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h2> <p>åœ¨å·¥ä½œä¸­ç»å¸¸ä¼šç¢°åˆ°è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨ ajax å‘ä¸€ä¸ª A è¯·æ±‚åï¼ŒæˆåŠŸåæ‹¿åˆ°æ•°æ®ï¼Œéœ€è¦æŠŠæ•°æ®ä¼ ç»™ B è¯·æ±‚ï¼›é‚£ä¹ˆéœ€è¦å¦‚ä¸‹ç¼–å†™ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>let fs = require('fs')
fs.readFile('./a.txt','utf8',function(err,data){
  fs.readFile(data,'utf8',function(err,data){
    fs.readFile(data,'utf8',function(err,data){
      console.log(data)
    })
  })
})
</code></pre></div><p>ä¸Šé¢çš„ä»£ç æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</p> <ul><li>åä¸€ä¸ªè¯·æ±‚éœ€è¦ä¾èµ–äºå‰ä¸€ä¸ªè¯·æ±‚æˆåŠŸåï¼Œå°†æ•°æ®å¾€ä¸‹ä¼ é€’ï¼Œä¼šå¯¼è‡´å¤šä¸ª ajax è¯·æ±‚åµŒå¥—çš„æƒ…å†µï¼Œä»£ç ä¸å¤Ÿç›´è§‚ã€‚</li> <li>å¦‚æœå‰åä¸¤ä¸ªè¯·æ±‚ä¸éœ€è¦ä¼ é€’å‚æ•°çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆåä¸€ä¸ªè¯·æ±‚ä¹Ÿéœ€è¦å‰ä¸€ä¸ªè¯·æ±‚æˆåŠŸåå†æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å¦‚ä¸Šç¼–å†™ä»£ç ï¼Œå¯¼è‡´ä»£ç ä¸å¤Ÿç›´è§‚ã€‚</li></ul> <p><code>Promise</code>å‡ºç°ä¹‹åï¼Œä»£ç å˜æˆè¿™æ ·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>let fs = require('fs')
function read(url){
  return new Promise((resolve,reject)=&gt;{
    fs.readFile(url,'utf8',function(error,data){
      error &amp;&amp; reject(error)
      resolve(data)
    })
  })
}
read('./a.txt').then(data=&gt;{
  return read(data)
}).then(data=&gt;{
  return read(data)
}).then(data=&gt;{
  console.log(data)
})
</code></pre></div><p>è¿™æ ·ä»£ç çœ‹èµ·äº†å°±ç®€æ´äº†å¾ˆå¤šï¼Œè§£å†³äº†åœ°ç‹±å›è°ƒçš„é—®é¢˜ã€‚</p> <h2 id="_6-promise-all-å’Œ-promise-race-çš„åŒºåˆ«çš„ä½¿ç”¨åœºæ™¯"><a href="#_6-promise-all-å’Œ-promise-race-çš„åŒºåˆ«çš„ä½¿ç”¨åœºæ™¯" class="header-anchor">#</a> 6. Promise.all å’Œ Promise.race çš„åŒºåˆ«çš„ä½¿ç”¨åœºæ™¯</h2> <p>**ï¼ˆ1ï¼‰****Promise.all**</p> <p><code>Promise.all</code>å¯ä»¥å°†å¤šä¸ª<code>Promise</code>å®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åŒæ—¶ï¼ŒæˆåŠŸå’Œå¤±è´¥çš„è¿”å›å€¼æ˜¯ä¸åŒçš„ï¼ŒæˆåŠŸçš„æ—¶å€™è¿”å›çš„æ˜¯<strong>ä¸€ä¸ªç»“æœæ•°ç»„</strong>ï¼Œè€Œå¤±è´¥çš„æ—¶å€™åˆ™è¿”å›<strong>æœ€å…ˆè¢« reject å¤±è´¥çŠ¶æ€çš„å€¼</strong>ã€‚</p> <p>Promise.all ä¸­ä¼ å…¥çš„æ˜¯æ•°ç»„ï¼Œè¿”å›çš„ä¹Ÿæ˜¯æ˜¯æ•°ç»„ï¼Œå¹¶ä¸”ä¼šå°†è¿›è¡Œæ˜ å°„ï¼Œä¼ å…¥çš„ promise å¯¹è±¡è¿”å›çš„å€¼æ˜¯æŒ‰ç…§é¡ºåºåœ¨æ•°ç»„ä¸­æ’åˆ—çš„ï¼Œä½†æ˜¯æ³¨æ„çš„æ˜¯ä»–ä»¬æ‰§è¡Œçš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§é¡ºåºçš„ï¼Œé™¤éå¯è¿­ä»£å¯¹è±¡ä¸ºç©ºã€‚</p> <p>éœ€è¦æ³¨æ„ï¼ŒPromise.all è·å¾—çš„æˆåŠŸç»“æœçš„æ•°ç»„é‡Œé¢çš„æ•°æ®é¡ºåºå’Œ Promise.all æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å½“é‡åˆ°å‘é€å¤šä¸ªè¯·æ±‚å¹¶æ ¹æ®è¯·æ±‚é¡ºåºè·å–å’Œä½¿ç”¨æ•°æ®çš„åœºæ™¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ Promise.all æ¥è§£å†³ã€‚</p> <p><strong>ï¼ˆ2ï¼‰Promise.race</strong></p> <p>é¡¾åæ€ä¹‰ï¼ŒPromse.race å°±æ˜¯èµ›è·‘çš„æ„æ€ï¼Œæ„æ€å°±æ˜¯è¯´ï¼ŒPromise.race([p1, p2, p3])é‡Œé¢å“ªä¸ªç»“æœè·å¾—çš„å¿«ï¼Œå°±è¿”å›é‚£ä¸ªç»“æœï¼Œä¸ç®¡ç»“æœæœ¬èº«æ˜¯æˆåŠŸçŠ¶æ€è¿˜æ˜¯å¤±è´¥çŠ¶æ€ã€‚å½“è¦åšä¸€ä»¶äº‹ï¼Œè¶…è¿‡å¤šé•¿æ—¶é—´å°±ä¸åšäº†ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥è§£å†³ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.race([promise1,timeOutPromise(5000)]).then(res=&gt;{})
</code></pre></div><h2 id="_7-å¯¹-async-await-çš„ç†è§£"><a href="#_7-å¯¹-async-await-çš„ç†è§£" class="header-anchor">#</a> 7. å¯¹ async/await çš„ç†è§£</h2> <p>async/await å…¶å®æ˜¯<code>Generator</code> çš„è¯­æ³•ç³–ï¼Œå®ƒèƒ½å®ç°çš„æ•ˆæœéƒ½èƒ½ç”¨ then é“¾æ¥å®ç°ï¼Œå®ƒæ˜¯ä¸ºä¼˜åŒ– then é“¾è€Œå¼€å‘å‡ºæ¥çš„ã€‚ä»å­—é¢ä¸Šæ¥çœ‹ï¼Œasync æ˜¯â€œå¼‚æ­¥â€çš„ç®€å†™ï¼Œawait åˆ™ä¸ºç­‰å¾…ï¼Œæ‰€ä»¥å¾ˆå¥½ç†è§£ async ç”¨äºç”³æ˜ä¸€ä¸ª function æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ await ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚å½“ç„¶è¯­æ³•ä¸Šå¼ºåˆ¶è§„å®š await åªèƒ½å‡ºç°åœ¨ asnyc å‡½æ•°ä¸­ï¼Œå…ˆæ¥çœ‹çœ‹ async å‡½æ•°è¿”å›äº†ä»€ä¹ˆï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>async function testAsy(){
   return 'hello world';
}
let result = testAsy();
console.log(result)
</code></pre></div><p><img src="F:%5C%E5%89%8D%E7%AB%AF%5C%E5%89%8D%E7%AB%AF%5CVuePress%5CBlog-VuePress%5Cdocs%5Cjavascript%5Cassets%5C9.png" alt="img"></p> <p>æ‰€ä»¥ï¼Œasync å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚async å‡½æ•°ï¼ˆåŒ…å«å‡½æ•°è¯­å¥ã€å‡½æ•°è¡¨è¾¾å¼ã€Lambda è¡¨è¾¾å¼ï¼‰ä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœåœ¨å‡½æ•°ä¸­ <code>return</code> ä¸€ä¸ªç›´æ¥é‡ï¼Œasync ä¼šæŠŠè¿™ä¸ªç›´æ¥é‡é€šè¿‡ <code>Promise.resolve()</code> å°è£…æˆ Promise å¯¹è±¡ã€‚</p> <p>async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨æœ€å¤–å±‚ä¸èƒ½ç”¨ await è·å–å…¶è¿”å›å€¼çš„æƒ…å†µä¸‹ï¼Œå½“ç„¶åº”è¯¥ç”¨åŸæ¥çš„æ–¹å¼ï¼š<code>then()</code> é“¾æ¥å¤„ç†è¿™ä¸ª Promise å¯¹è±¡ï¼Œå°±åƒè¿™æ ·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>async function testAsy(){
   return 'hello world'
}
let result = testAsy()
console.log(result)
result.then(v=&gt;{
    console.log(v)   // hello world
})
</code></pre></div><p>é‚£å¦‚æœ async å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œåˆè¯¥å¦‚ä½•ï¼Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå®ƒä¼šè¿”å› <code>Promise.resolve(undefined)</code>ã€‚</p> <p>è”æƒ³ä¸€ä¸‹ Promise çš„ç‰¹ç‚¹â€”â€”æ— ç­‰å¾…ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰ <code>await</code> çš„æƒ…å†µä¸‹æ‰§è¡Œ async å‡½æ•°ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”ï¼Œç»ä¸ä¼šé˜»å¡åé¢çš„è¯­å¥ã€‚è¿™å’Œæ™®é€šè¿”å› Promise å¯¹è±¡çš„å‡½æ•°å¹¶æ— äºŒè‡´ã€‚</p> <p><strong>æ³¨æ„ï¼š</strong><code>Promise.resolve(x)</code> å¯ä»¥çœ‹ä½œæ˜¯ <code>new Promise(resolve =&gt; resolve(x))</code> çš„ç®€å†™ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿå°è£…å­—é¢é‡å¯¹è±¡æˆ–å…¶ä»–å¯¹è±¡ï¼Œå°†å…¶å°è£…æˆ Promise å®ä¾‹ã€‚</p> <h2 id="_8-await-åˆ°åº•åœ¨ç­‰å•¥"><a href="#_8-await-åˆ°åº•åœ¨ç­‰å•¥" class="header-anchor">#</a> 8. await åˆ°åº•åœ¨ç­‰å•¥ï¼Ÿ</h2> <p>**await åœ¨ç­‰å¾…ä»€ä¹ˆå‘¢ï¼Ÿ**ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½è®¤ä¸º await æ˜¯åœ¨ç­‰å¾…ä¸€ä¸ª async å‡½æ•°å®Œæˆã€‚ä¸è¿‡æŒ‰è¯­æ³•è¯´æ˜ï¼Œawait ç­‰å¾…çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ˜¯ Promise å¯¹è±¡æˆ–è€…å…¶å®ƒå€¼ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ²¡æœ‰ç‰¹æ®Šé™å®šï¼‰ã€‚</p> <p>å› ä¸º async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ‰€ä»¥ await å¯ä»¥ç”¨äºç­‰å¾…ä¸€ä¸ª async å‡½æ•°çš„è¿”å›å€¼â€”â€”è¿™ä¹Ÿå¯ä»¥è¯´æ˜¯ await åœ¨ç­‰ async å‡½æ•°ï¼Œä½†è¦æ¸…æ¥šï¼Œå®ƒç­‰çš„å®é™…æ˜¯ä¸€ä¸ªè¿”å›å€¼ã€‚æ³¨æ„åˆ° await ä¸ä»…ä»…ç”¨äºç­‰ Promise å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç­‰ä»»æ„è¡¨è¾¾å¼çš„ç»“æœï¼Œæ‰€ä»¥ï¼Œawait åé¢å®é™…æ˜¯å¯ä»¥æ¥æ™®é€šå‡½æ•°è°ƒç”¨æˆ–è€…ç›´æ¥é‡çš„ã€‚æ‰€ä»¥ä¸‹é¢è¿™ä¸ªç¤ºä¾‹å®Œå…¨å¯ä»¥æ­£ç¡®è¿è¡Œï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function getSomething() {
    return &quot;something&quot;;
}
async function testAsync() {
    return Promise.resolve(&quot;hello async&quot;);
}
async function test() {
    const v1 = await getSomething();
    const v2 = await testAsync();
    console.log(v1, v2);
}
test();
</code></pre></div><p>await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå–å†³äºå®ƒç­‰çš„æ˜¯ä»€ä¹ˆã€‚</p> <ul><li>å¦‚æœå®ƒç­‰åˆ°çš„ä¸æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå°±æ˜¯å®ƒç­‰åˆ°çš„ä¸œè¥¿ã€‚</li> <li>å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œawait å°±å¿™èµ·æ¥äº†ï¼Œå®ƒä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ resolveï¼Œç„¶åå¾—åˆ° resolve çš„å€¼ï¼Œä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚</li></ul> <p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function testAsy(x){
   return new Promise(resolve=&gt;{setTimeout(() =&gt; {
       resolve(x);
     }, 3000)
    }
   )
}
async function testAwt(){
  let result =  await testAsy('hello world');
  console.log(result);    // 3ç§’é’Ÿä¹‹åå‡ºç°hello world
  console.log('cuger')   // 3ç§’é’Ÿä¹‹åå‡ºç°cug
}
testAwt();
console.log('cug')  //ç«‹å³è¾“å‡ºcug
</code></pre></div><p>è¿™å°±æ˜¯ await å¿…é¡»ç”¨åœ¨ async å‡½æ•°ä¸­çš„åŸå› ã€‚async å‡½æ•°è°ƒç”¨ä¸ä¼šé€ æˆé˜»å¡ï¼Œå®ƒå†…éƒ¨æ‰€æœ‰çš„é˜»å¡éƒ½è¢«å°è£…åœ¨ä¸€ä¸ª Promise å¯¹è±¡ä¸­å¼‚æ­¥æ‰§è¡Œã€‚await æš‚åœå½“å‰ async çš„æ‰§è¡Œï¼Œæ‰€ä»¥'cug''æœ€å…ˆè¾“å‡ºï¼Œhello world'å’Œâ€˜cugerâ€™æ˜¯ 3 ç§’é’ŸååŒæ—¶å‡ºç°çš„ã€‚</p> <h2 id="_9-async-await-çš„ä¼˜åŠ¿"><a href="#_9-async-await-çš„ä¼˜åŠ¿" class="header-anchor">#</a> 9. async/await çš„ä¼˜åŠ¿</h2> <p>å•ä¸€çš„ Promise é“¾å¹¶ä¸èƒ½å‘ç° async/await çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯ï¼Œå¦‚æœéœ€è¦å¤„ç†ç”±å¤šä¸ª Promise ç»„æˆçš„ then é“¾çš„æ—¶å€™ï¼Œä¼˜åŠ¿å°±èƒ½ä½“ç°å‡ºæ¥äº†ï¼ˆå¾ˆæœ‰æ„æ€ï¼ŒPromise é€šè¿‡ then é“¾æ¥è§£å†³å¤šå±‚å›è°ƒçš„é—®é¢˜ï¼Œç°åœ¨åˆç”¨ async/await æ¥è¿›ä¸€æ­¥ä¼˜åŒ–å®ƒï¼‰ã€‚</p> <p>å‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”ä¾èµ–äºä¸Šä¸€ä¸ªæ­¥éª¤çš„ç»“æœã€‚ä»ç„¶ç”¨ <code>setTimeout</code> æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * ä¼ å…¥å‚æ•° nï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * æ‰§è¡Œçš„ç»“æœæ˜¯ n + 200ï¼Œè¿™ä¸ªå€¼å°†ç”¨äºä¸‹ä¸€æ­¥éª¤
 */
function takeLongTime(n) {
    return new Promise(resolve =&gt; {
        setTimeout(() =&gt; resolve(n + 200), n);
    });
}
function step1(n) {
    console.log(`step1 with ${n}`);
    return takeLongTime(n);
}
function step2(n) {
    console.log(`step2 with ${n}`);
    return takeLongTime(n);
}
function step3(n) {
    console.log(`step3 with ${n}`);
    return takeLongTime(n);
}
</code></pre></div><p>ç°åœ¨ç”¨ Promise æ–¹å¼æ¥å®ç°è¿™ä¸‰ä¸ªæ­¥éª¤çš„å¤„ç†ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function doIt() {
    console.time(&quot;doIt&quot;);
    const time1 = 300;
    step1(time1)
        .then(time2 =&gt; step2(time2))
        .then(time3 =&gt; step3(time3))
        .then(result =&gt; {
            console.log(`result is ${result}`);
            console.timeEnd(&quot;doIt&quot;);
        });
}
doIt();
// c:\var\test&gt;node --harmony_async_await .
// step1 with 300
// step2 with 500
// step3 with 700
// result is 900
// doIt: 1507.251ms
</code></pre></div><p>å¦‚æœç”¨ async/await æ¥å®ç°å‘¢ï¼Œä¼šæ˜¯è¿™æ ·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>async function doIt() {
    console.time(&quot;doIt&quot;);
    const time1 = 300;
    const time2 = await step1(time1);
    const time3 = await step2(time2);
    const result = await step3(time3);
    console.log(`result is ${result}`);
    console.timeEnd(&quot;doIt&quot;);
}
doIt();
</code></pre></div><p>ç»“æœå’Œä¹‹å‰çš„ Promise å®ç°æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™ä¸ªä»£ç çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æ¸…æ™°å¾—å¤šï¼Œå‡ ä¹è·ŸåŒæ­¥ä»£ç ä¸€æ ·</p> <h2 id="_10-async-await-å¯¹æ¯”-promise-çš„ä¼˜åŠ¿"><a href="#_10-async-await-å¯¹æ¯”-promise-çš„ä¼˜åŠ¿" class="header-anchor">#</a> 10. async/await å¯¹æ¯” Promise çš„ä¼˜åŠ¿</h2> <ul><li>ä»£ç è¯»èµ·æ¥æ›´åŠ åŒæ­¥ï¼ŒPromise è™½ç„¶æ‘†è„±äº†å›è°ƒåœ°ç‹±ï¼Œä½†æ˜¯ then çš„é“¾å¼è°ƒâ½¤ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„é˜…è¯»è´Ÿæ‹…</li> <li>Promise ä¼ é€’ä¸­é—´å€¼â¾®å¸¸éº»çƒ¦ï¼Œâ½½ async/await â¼ä¹æ˜¯åŒæ­¥çš„å†™æ³•ï¼Œâ¾®å¸¸ä¼˜é›…</li> <li>é”™è¯¯å¤„ç†å‹å¥½ï¼Œasync/await å¯ä»¥â½¤æˆç†Ÿçš„ try/catchï¼ŒPromise çš„é”™è¯¯æ•è·â¾®å¸¸å†—ä½™</li> <li>è°ƒè¯•å‹å¥½ï¼ŒPromise çš„è°ƒè¯•å¾ˆå·®ï¼Œç”±äºæ²¡æœ‰ä»£ç å—ï¼Œä½ ä¸èƒ½åœ¨â¼€ä¸ªè¿”å›è¡¨è¾¾å¼çš„ç®­å¤´å‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹ï¼Œå¦‚æœä½ åœ¨â¼€ä¸ª.then ä»£ç å—ä¸­ä½¿â½¤è°ƒè¯•å™¨çš„æ­¥è¿›(step-over)åŠŸèƒ½ï¼Œè°ƒè¯•å™¨å¹¶ä¸ä¼šè¿›â¼Šåç»­çš„.then ä»£ç å—ï¼Œå› ä¸ºè°ƒè¯•å™¨åªèƒ½è·Ÿè¸ªåŒæ­¥ä»£ç çš„æ¯â¼€æ­¥ã€‚</li></ul> <h2 id="_11-async-await-å¦‚ä½•æ•è·å¼‚å¸¸"><a href="#_11-async-await-å¦‚ä½•æ•è·å¼‚å¸¸" class="header-anchor">#</a> 11. async/await å¦‚ä½•æ•è·å¼‚å¸¸</h2> <div class="language- extra-class"><pre class="language-text"><code>async function fn(){
    try{
        let a = await Promise.reject('error')
    }catch(error){
        console.log(error)
    }
}
</code></pre></div><h2 id="_12-å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«-äº†è§£å³å¯"><a href="#_12-å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«-äº†è§£å³å¯" class="header-anchor">#</a> 12. å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«ï¼Ÿ---äº†è§£å³å¯</h2> <ul><li>å¹¶å‘æ˜¯å®è§‚æ¦‚å¿µï¼Œæˆ‘åˆ†åˆ«æœ‰ä»»åŠ¡ A å’Œä»»åŠ¡ Bï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…é€šè¿‡ä»»åŠ¡é—´çš„åˆ‡æ¢å®Œæˆäº†è¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥ç§°ä¹‹ä¸ºå¹¶å‘ã€‚</li> <li>å¹¶è¡Œæ˜¯å¾®è§‚æ¦‚å¿µï¼Œå‡è®¾ CPU ä¸­å­˜åœ¨ä¸¤ä¸ªæ ¸å¿ƒï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥åŒæ—¶å®Œæˆä»»åŠ¡ Aã€Bã€‚åŒæ—¶å®Œæˆå¤šä¸ªä»»åŠ¡çš„æƒ…å†µå°±å¯ä»¥ç§°ä¹‹ä¸ºå¹¶è¡Œã€‚</li></ul> <h2 id="_13-ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°-å›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹-å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜"><a href="#_13-ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°-å›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹-å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜" class="header-anchor">#</a> 13. ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼Ÿå›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿå¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼Ÿ</h2> <p>ä»¥ä¸‹ä»£ç å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°çš„ä¾‹å­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ajax(url, () =&gt; {
    // å¤„ç†é€»è¾‘
})
</code></pre></div><p>å›è°ƒå‡½æ•°æœ‰ä¸€ä¸ªè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å®¹æ˜“å†™å‡ºå›è°ƒåœ°ç‹±ï¼ˆCallback hellï¼‰ã€‚å‡è®¾å¤šä¸ªè¯·æ±‚å­˜åœ¨ä¾èµ–æ€§ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ajax(url, () =&gt; {
    // å¤„ç†é€»è¾‘
    ajax(url1, () =&gt; {
        // å¤„ç†é€»è¾‘
        ajax(url2, () =&gt; {
            // å¤„ç†é€»è¾‘
        })
    })
})
</code></pre></div><p>ä»¥ä¸Šä»£ç çœ‹èµ·æ¥ä¸åˆ©äºé˜…è¯»å’Œç»´æŠ¤ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠå‡½æ•°åˆ†å¼€æ¥å†™ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function firstAjax() {
  ajax(url1, () =&gt; {
    // å¤„ç†é€»è¾‘
    secondAjax()
  })
}
function secondAjax() {
  ajax(url2, () =&gt; {
    // å¤„ç†é€»è¾‘
  })
}
ajax(url, () =&gt; {
  // å¤„ç†é€»è¾‘
  firstAjax()
})
</code></pre></div><p>ä»¥ä¸Šçš„ä»£ç è™½ç„¶çœ‹ä¸Šå»åˆ©äºé˜…è¯»äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜ã€‚å›è°ƒåœ°ç‹±çš„æ ¹æœ¬é—®é¢˜å°±æ˜¯ï¼š</p> <ol><li>åµŒå¥—å‡½æ•°å­˜åœ¨è€¦åˆæ€§ï¼Œä¸€æ—¦æœ‰æ‰€æ”¹åŠ¨ï¼Œå°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«</li> <li>åµŒå¥—å‡½æ•°ä¸€å¤šï¼Œå°±å¾ˆéš¾å¤„ç†é”™è¯¯</li></ol> <p>å½“ç„¶ï¼Œå›è°ƒå‡½æ•°è¿˜å­˜åœ¨ç€åˆ«çš„å‡ ä¸ªç¼ºç‚¹ï¼Œæ¯”å¦‚ä¸èƒ½ä½¿ç”¨ <code>try catch</code> æ•è·é”™è¯¯ï¼Œä¸èƒ½ç›´æ¥ <code>return</code>ã€‚</p> <h2 id="_14-settimeoutã€setintervalã€requestanimationframe-å„æœ‰ä»€ä¹ˆç‰¹ç‚¹"><a href="#_14-settimeoutã€setintervalã€requestanimationframe-å„æœ‰ä»€ä¹ˆç‰¹ç‚¹" class="header-anchor">#</a> 14. setTimeoutã€setIntervalã€requestAnimationFrame å„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h2> <p>å¼‚æ­¥ç¼–ç¨‹å½“ç„¶å°‘ä¸äº†å®šæ—¶å™¨äº†ï¼Œå¸¸è§çš„å®šæ—¶å™¨å‡½æ•°æœ‰ <code>setTimeout</code>ã€<code>setInterval</code>ã€<code>requestAnimationFrame</code>ã€‚æœ€å¸¸ç”¨çš„æ˜¯<code>setTimeout</code>ï¼Œå¾ˆå¤šäººè®¤ä¸º <code>setTimeout</code> æ˜¯å»¶æ—¶å¤šä¹…ï¼Œé‚£å°±åº”è¯¥æ˜¯å¤šä¹…åæ‰§è¡Œã€‚</p> <p>å…¶å®è¿™ä¸ªè§‚ç‚¹æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º JS æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¦‚æœå‰é¢çš„ä»£ç å½±å“äº†æ€§èƒ½ï¼Œå°±ä¼šå¯¼è‡´ <code>setTimeout</code> ä¸ä¼šæŒ‰æœŸæ‰§è¡Œã€‚å½“ç„¶äº†ï¼Œå¯ä»¥é€šè¿‡ä»£ç å»ä¿®æ­£ <code>setTimeout</code>ï¼Œä»è€Œä½¿å®šæ—¶å™¨ç›¸å¯¹å‡†ç¡®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>let period = 60 * 1000 * 60 * 2
let startTime = new Date().getTime()
let count = 0
let end = new Date().getTime() + period
let interval = 1000
let currentInterval = interval
function loop() {
  count++
  // ä»£ç æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´
  let offset = new Date().getTime() - (startTime + count * interval);
  let diff = end - new Date().getTime()
  let h = Math.floor(diff / (60 * 1000 * 60))
  let hdiff = diff % (60 * 1000 * 60)
  let m = Math.floor(hdiff / (60 * 1000))
  let mdiff = hdiff % (60 * 1000)
  let s = mdiff / (1000)
  let sCeil = Math.ceil(s)
  let sFloor = Math.floor(s)
  // å¾—åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯æ‰€æ¶ˆè€—çš„æ—¶é—´
  currentInterval = interval - offset
  console.log('æ—¶ï¼š'+h, 'åˆ†ï¼š'+m, 'æ¯«ç§’ï¼š'+s, 'ç§’å‘ä¸Šå–æ•´ï¼š'+sCeil, 'ä»£ç æ‰§è¡Œæ—¶é—´ï¼š'+offset, 'ä¸‹æ¬¡å¾ªç¯é—´éš”'+currentInterval)
  setTimeout(loop, currentInterval)
}
setTimeout(loop, currentInterval)
</code></pre></div><p>æ¥ä¸‹æ¥çœ‹ <code>setInterval</code>ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°ä½œç”¨å’Œ <code>setTimeout</code> åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯è¯¥å‡½æ•°æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚</p> <p>é€šå¸¸æ¥è¯´ä¸å»ºè®®ä½¿ç”¨ <code>setInterval</code>ã€‚ç¬¬ä¸€ï¼Œå®ƒå’Œ <code>setTimeout</code> ä¸€æ ·ï¼Œä¸èƒ½ä¿è¯åœ¨é¢„æœŸçš„æ—¶é—´æ‰§è¡Œä»»åŠ¡ã€‚ç¬¬äºŒï¼Œå®ƒå­˜åœ¨æ‰§è¡Œç´¯ç§¯çš„é—®é¢˜ï¼Œè¯·çœ‹ä»¥ä¸‹ä¼ªä»£ç </p> <div class="language- extra-class"><pre class="language-text"><code>function demo() {
  setInterval(function(){
    console.log(2)
  },1000)
  sleep(2000)
}
demo()
</code></pre></div><p>ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå¦‚æœå®šæ—¶å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†è€—æ—¶æ“ä½œï¼Œå¤šä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨è€—æ—¶æ“ä½œç»“æŸä»¥ååŒæ—¶æ‰§è¡Œï¼Œè¿™æ ·å¯èƒ½å°±ä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚</p> <p>å¦‚æœæœ‰å¾ªç¯å®šæ—¶å™¨çš„éœ€æ±‚ï¼Œå…¶å®å®Œå…¨å¯ä»¥é€šè¿‡ <code>requestAnimationFrame</code> æ¥å®ç°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function setInterval(callback, interval) {
  let timer
  const now = Date.now
  let startTime = now()
  let endTime = startTime
  const loop = () =&gt; {
    timer = window.requestAnimationFrame(loop)
    endTime = now()
    if (endTime - startTime &gt;= interval) {
      startTime = endTime = now()
      callback(timer)
    }
  }
  timer = window.requestAnimationFrame(loop)
  return timer
}
let a = 0
setInterval(timer =&gt; {
  console.log(1)
  a++
  if (a === 3) cancelAnimationFrame(timer)
}, 1000)
</code></pre></div><p>é¦–å…ˆ <code>requestAnimationFrame</code> è‡ªå¸¦å‡½æ•°èŠ‚æµåŠŸèƒ½ï¼ŒåŸºæœ¬å¯ä»¥ä¿è¯åœ¨ 16.6 æ¯«ç§’å†…åªæ‰§è¡Œä¸€æ¬¡ï¼ˆä¸æ‰å¸§çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¹¶ä¸”è¯¥å‡½æ•°çš„å»¶æ—¶æ•ˆæœæ˜¯ç²¾ç¡®çš„ï¼Œæ²¡æœ‰å…¶ä»–å®šæ—¶å™¨æ—¶é—´ä¸å‡†çš„é—®é¢˜ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥å®ç° <code>setTimeout</code>ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/javascript/6.thisã€callã€applyã€bind.html" class="prev">
        å…­ã€this/call/apply/bind
      </a></span> <span class="next"><a href="/javascript/8.é¢å‘å¯¹è±¡.html">
        å…«ã€é¢å‘å¯¹è±¡
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.61103f05.js" defer></script><script src="/assets/js/3.5422f50d.js" defer></script><script src="/assets/js/56.6e6b6725.js" defer></script>
  </body>
</html>
